import{f as A,g as _,h as r,r as f,s as F,o as H,u as U,i as I,j as S,c,a as t,t as y,w,k as N,v as V,l as $,d as C,n as L,m as O,F as B,p as M,e as u,q as P}from"./index-B67N46TK.js";const z="/vite-rookie-hw4/assets/empty-CN3X7Dzs.png",g=A("todos",{state:()=>({todos:[]}),actions:{},persist:{key:"todos"}}),k=o=>{console.error("API 錯誤:",o)},K=async()=>{try{const o=await _(r().token).get(f.todos.fetchTodos());o.data.status&&(g().todos=o.data.data)}catch(o){k(o)}},R=async o=>{try{const e=await _(r().token).post(f.todos.createTodo(),{content:o});if(e.data.status)return e.data.newTodo}catch(e){k(e)}},j=async o=>{try{(await _(r().token).patch(f.todos.toggle(o))).data.status}catch(e){k(e)}},q=async o=>{try{const e=await _(r().token).delete(f.todos.deleteTodo(o));e.data.status||console.error("刪除失敗",e.data)}catch(e){k(e)}},X=async()=>{try{await _(r().token).post(f.auth.logout()),r().$reset(),g().$reset()}catch(o){console.error("Logout failed:",o)}},G=(o,e)=>{const h=o.__vccOpts||o;for(const[l,m]of e)h[l]=m;return h},J={id:"todoListPage",class:"bg-half"},Q={class:"todo_sm"},W={class:"conatiner todoListPage vhContainer"},Y={class:"todoList_Content"},Z={class:"inputBox"},tt={key:0,class:"todoList_list"},st={class:"todoList_tab"},ot={class:"todoList_items"},et={class:"todoList_item"},at={class:"todoList_label"},nt=["onUpdate:modelValue","onChange"],lt=["onClick"],it={key:0,class:"todoList_statistics"},dt={key:1,class:"todoList_empty"},rt={__name:"TodoView",setup(o){const e=U(),h=g(),{todos:l}=F(h);H(async()=>{r().token||e.push({name:"home"}),await K()});const m=I(()=>{const a=r();return(a.nickname||a.email)+"的代辦"}),i={ALL:"all",UNFINISHED:"unfinished",FINISHED:"finished"},d=S(i.ALL),v=S(""),b=I(()=>{switch(d.value){case i.UNFINISHED:return l.value.filter(a=>!a.status);case i.FINISHED:return l.value.filter(a=>a.status);default:return l.value}}),D=a=>{l.value=l.value.filter(s=>s.id!==a),q(a)},x=a=>{j(a)},T=async()=>{if(v.value.trim()){const a={id:Date.now().toString(),content:v.value,status:!1};l.value.push(a),v.value="";const s=await R(a.content);if(!s)return;const n=l.value.findIndex(p=>p.id===a.id);l.value.splice(n,1,s)}},E=()=>{X(),e.push({name:"home"})};return(a,s)=>(u(),c("div",J,[t("nav",null,[s[4]||(s[4]=t("h1",null,[t("a",{href:"#"},"ONLINE TODO LIST")],-1)),t("ul",null,[t("li",Q,[t("span",null,y(m.value),1)]),t("li",null,[t("a",{href:"#",onClick:w(E,["prevent"])},"登出")])])]),t("div",W,[t("div",Y,[t("div",Z,[N(t("input",{type:"text",placeholder:"請輸入待辦事項","onUpdate:modelValue":s[0]||(s[0]=n=>v.value=n),onKeyup:$(T,["enter"])},null,544),[[V,v.value]]),t("button",{onClick:w(T,["prevent"])},[...s[5]||(s[5]=[t("i",{class:"fa fa-plus"},null,-1)])])]),C(l).length?(u(),c("div",tt,[t("ul",st,[t("li",null,[t("a",{onClick:s[1]||(s[1]=n=>d.value=i.ALL),class:L({active:d.value===i.ALL})},"全部",2)]),t("li",null,[t("a",{onClick:s[2]||(s[2]=n=>d.value=i.UNFINISHED),class:L({active:d.value===i.UNFINISHED})},"待完成",2)]),t("li",null,[t("a",{onClick:s[3]||(s[3]=n=>d.value=i.FINISHED),class:L({active:d.value===i.FINISHED})},"已完成",2)])]),t("div",ot,[t("ul",et,[(u(!0),c(B,null,M(b.value,n=>(u(),c("li",{key:n.id},[t("label",at,[N(t("input",{class:"todoList_input",type:"checkbox","onUpdate:modelValue":p=>n.status=p,onChange:p=>x(n.id)},null,40,nt),[[P,n.status]]),t("span",null,y(n.content),1),t("button",{onClick:p=>D(n.id),class:"todoList_close"},[...s[6]||(s[6]=[t("i",{class:"fa fa-times"},null,-1)])],8,lt)])]))),128))]),d.value===i.ALL?(u(),c("div",it,[t("p",null,y(C(l).filter(n=>n.status).length)+" 個已完成項目",1)])):O("",!0)])])):(u(),c("div",dt,[...s[7]||(s[7]=[t("div",{class:"todoList_empty_content"},[t("h2",null,"目前沒有待辦事項"),t("img",{src:z,alt:"edit_empty_bg",draggable:"false"})],-1)])]))])])]))}},ut=G(rt,[["__scopeId","data-v-bb9b4221"]]);export{ut as default};
